# MC远程控制客户端（Windows版）运行指南

## 项目简介
本客户端是MC远程控制系统的Windows操作端，通过公网PHP中转服务器实现对网易版Minecraft的远程控制，支持：
- 远程执行MC指令
- 定时/手动查询玩家数量和名单
- 无公网IP环境下的通信
- 指令优先级管理（用户指令优先）
- 断连自动重连

## 环境准备

### 1. 硬件要求
- Windows 10/11操作系统
- 至少4GB内存
- 稳定的网络连接

### 2. 软件要求
- Python 3.8或更高版本
- 网易版Minecraft客户端
- 管理员权限

### 3. 网络要求
- 客户端能访问公网PHP服务器
- 服务器9501端口已开放

## 安装步骤

### 1. 安装Python
从官网下载并安装Python 3.8+：https://www.python.org/downloads/

**注意**：安装时勾选"Add Python to PATH"选项。

### 2. 安装依赖库
以管理员身份打开CMD，执行以下命令：

```bash
# 进入项目目录
cd /d e:\project\dashcraft-WindowsClient

# 安装核心依赖
pip install -r requirements.txt

# 可选：使用国内源安装paddlepaddle（提升OCR性能）
pip install paddlepaddle -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## 配置修改

### 1. 修改服务器配置
编辑 `mc_client.py` 文件，修改以下配置：

```python
# 公网PHP服务器配置
SERVER_HOST = "你的公网域名/IP"  # 替换为实际服务器地址
SERVER_PORT = 9501              # 与PHP端config.php一致
SECRET_KEY = "7e8f9a0b1c2d3e4f5g6h7i8j9k0l1m2n3o4p5q6r7s8t9u0v1w2x3y4z5a6b7c8d9e0f1"  # 与PHP端一致

# MC窗口配置（网易版默认名称，可根据实际调整）
MC_WINDOW_NAME = "我的世界"
```

**重要**：`SECRET_KEY` 必须与PHP端 `config.php` 中的密钥完全一致。

### 2. MC客户端准备
- 启动网易版Minecraft并进入目标服务器
- 将MC窗口设置为**窗口化模式**（非全屏）
- 关闭MC窗口的中文输入法（切换为英文）

## 运行客户端

### 1. 启动方式
以管理员身份打开CMD，执行：

```bash
# 进入项目目录
cd /d e:\project\dashcraft-WindowsClient

# 运行客户端
python mc_client.py
```

### 2. 验证运行状态
客户端启动后，日志应显示：
- `[连接] 服务器连接成功，密钥验证通过`
- `[线程] 指令消费线程已启动（用户指令优先执行）`
- `[线程] 定时查询线程已启动，默认间隔：10秒`
- `[线程] 服务器通信线程已启动，等待指令...`

## 使用方法

### 通过网页端控制
1. 打开PHP服务器部署的网页端（如 `https://你的域名/index.php`）
2. 在指令输入框中输入MC指令（如 `list`、`gamemode creative @a` 等）
3. 点击"执行指令"按钮
4. 查看执行结果和玩家信息

### 定时查询配置
- 在网页端的"定时查询配置"区域修改查询间隔（建议≥5秒）
- 点击"修改查询间隔"按钮生效

## 常见问题排查

| 问题现象                  | 排查方案                                                                 |
|---------------------------|--------------------------------------------------------------------------|
| 无法找到MC窗口            | 确认MC窗口名称正确；MC已启动且未最小化；以管理员身份运行客户端             |
| 键鼠模拟无效果            | MC窗口需为前台窗口；关闭MC全屏；切换为英文输入法；确认管理员权限         |
| 玩家数量识别失败          | 微调 `chat_box_rect` 坐标；检查OCR依赖是否安装完整；确保聊天框有/list返回结果 |
| 客户端无法连接服务器      | 检查服务器9501端口是否放行；确认SERVER_HOST/SERVER_PORT正确；密钥是否一致 |
| 定时查询不执行            | 检查高优先级队列是否有未执行的指令；确认查询间隔≥5秒；日志是否有报错     |
| OCR识别速度慢             | 安装paddlepaddle；确保网络畅通；考虑降低识别精度以提升速度               |

## 日志说明
客户端运行时会输出详细日志，包括：
- 服务器连接状态
- 指令执行情况
- 错误信息
- 定时查询结果

## 注意事项

1. **安全警告**：请勿将 `SECRET_KEY` 泄露给他人，以免被恶意控制。
2. **性能影响**：定时查询间隔建议≥5秒，避免频繁操作影响MC运行。
3. **稳定性**：长时间运行可能会占用一定系统资源，建议定期重启客户端。
4. **兼容性**：仅支持网易版Minecraft，其他版本可能需要调整窗口名称和指令格式。

## 技术支持

### 联系方式
- 如有问题，请查看日志中的错误信息
- 检查网络连接和服务器状态
- 确认所有配置参数正确

### 版本信息
- 客户端版本：v1.0.0
- 支持Python版本：3.8+
- 最后更新：2026-02-12
